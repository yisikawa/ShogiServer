# エンジン起動エラー対策

エラーコード `3221225781` (0xC0000135) が発生した場合の対策です。

## エラーの意味

このエラーコードは通常、以下のいずれかを意味します：
- **STATUS_DLL_NOT_FOUND**: 必要なDLLファイルが見つからない
- エンジンの実行ディレクトリが正しく設定されていない
- 依存ファイルが不足している

## 対策

### 1. 絶対パスを使用する

相対パスではなく、絶対パスを指定してください：

```powershell
# PowerShell
$env:ENGINE_PATH="d:\Cursor\ShogiServer\dlshogi-dr2_exhi\dlshogi_tensorrt.exe"
npm start
```

### 2. エンジンのディレクトリを確認

エンジンの実行ファイルと同じディレクトリに、必要なDLLファイルが存在するか確認してください：

```powershell
# エンジンのディレクトリを確認
cd d:\Cursor\ShogiServer\dlshogi-dr2_exhi
dir *.dll
```

### 3. エンジンを直接実行してテスト

エンジンが正常に起動するか確認：

```powershell
cd d:\Cursor\ShogiServer\dlshogi-dr2_exhi
.\dlshogi_tensorrt.exe
```

正常に起動する場合、USIプロンプトが表示されるか、何も表示されない状態になります。

### 4. サーバーコードの改善

サーバーコードは既に改善済みです：
- エンジンのディレクトリを作業ディレクトリに設定
- 絶対パスへの変換
- ファイル存在確認

### 5. 環境変数PATHの確認

エンジンが依存するDLLがシステムPATHに含まれているか確認：

```powershell
$env:PATH
```

## 推奨される起動方法

### 方法1: 絶対パスで起動

```powershell
cd d:\Cursor\ShogiServer
$env:ENGINE_PATH="d:\Cursor\ShogiServer\dlshogi-dr2_exhi\dlshogi_tensorrt.exe"
npm start
```

### 方法2: 起動スクリプトを修正

`start-server.ps1`で絶対パスを使用：

```powershell
$enginePath = Resolve-Path ".\dlshogi-dr2_exhi\dlshogi_tensorrt.exe"
$env:ENGINE_PATH = $enginePath
npm start
```

## デバッグ方法

### サーバーのログを確認

サーバーのコンソールに表示されるエラーメッセージを確認してください。

### エンジンのログを確認

エンジンがstderrに出力するメッセージを確認：

```
エンジンエラー: [エラーメッセージ]
```

### エンジンを直接実行

エンジンを直接実行して、どのようなエラーが発生するか確認：

```powershell
cd d:\Cursor\ShogiServer\dlshogi-dr2_exhi
.\dlshogi_tensorrt.exe
```

## よくある原因

1. **DLLの不足**: エンジンが依存するDLLが同じディレクトリにない
2. **Visual C++ ランタイムの不足**: Visual C++ Redistributableが必要
3. **CUDA/GPU関連のDLL不足**: TensorRTエンジンの場合、CUDA関連のDLLが必要
4. **パスの問題**: 相対パスが正しく解決されていない

## 次のステップ

1. エンジンを直接実行して動作確認
2. 必要なDLLが揃っているか確認
3. 絶対パスで起動を試す
4. エラーメッセージを確認して、不足しているファイルを特定



